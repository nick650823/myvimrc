set nocompatible              " be iMproved, required
filetype off                  " required

" set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

" let Vundle manage Vundle, required
Plugin 'VundleVim/Vundle.vim'
Plugin 'tomasr/molokai'
Plugin 'Lokaltog/vim-powerline'
Plugin 'vim-scripts/indexer.tar.gz'
Plugin 'vim-scripts/DfrankUtil'
Plugin 'vim-scripts/vimprj'
Plugin 'scrooloose/nerdtree'
Plugin 'fholgado/minibufexpl.vim'
Plugin 'sjl/gundo.vim'
Plugin 'junegunn/fzf'
Plugin 'junegunn/fzf.vim'
Plugin 'tpope/vim-fugitive'
Plugin 'haya14busa/incsearch.vim'

call vundle#end()            " required
filetype plugin indent on    " required

" augement
let g:augment_workspace_folders = ['/scratch2/nickh/work/ras/linux-private']

" Minibufexpl
noremap <C-Down>  <C-W>j
noremap <C-Up>    <C-W>k
noremap <C-Left>  <C-W>h
noremap <C-Right> <C-W>l
noremap <C-k>   :MBEbn<CR>
noremap <C-j>   :MBEbp<CR>

" PowerLine
set laststatus=2
let g:Powerline_colorscheme='solarized256'

" Gundo
nnoremap <F6> :GundoToggle<CR>
if has('python3')
	let g:gundo_prefer_python3 = 1
endif

function ToggleMouse()
	if &mouse == 'a'
		set mouse=
		echo 'Mouse mode Off'
	else
		set mouse=a
		echo 'Mouse mode on'
	endif
endfunction

nnoremap <F3> :call ToggleMouse()<CR>

set nu
highlight LineNr cterm=none ctermfg=DarkGrey ctermbg=none
nnoremap <F2> :set nonumber!<CR>

set cursorline
set shiftwidth=8
set tabstop=8
set mouse=a
set colorcolumn=100
set t_Co=256
set background=dark

" Toggle the listchar
"set list
set listchars=tab:>-,trail:$

nnoremap <F4> :set list!<CR>

map /  <Plug>(incsearch-forward)
map ?  <Plug>(incsearch-backward)
map g/ <Plug>(incsearch-stay)

set hlsearch
let g:incsearch#auto_nohlsearch = 1
map n  <Plug>(incsearch-nohl-n)
map N  <Plug>(incsearch-nohl-N)
map *  <Plug>(incsearch-nohl-*)
map #  <Plug>(incsearch-nohl-#)
map g* <Plug>(incsearch-nohl-g*)
map g# <Plug>(incsearch-nohl-g#)

hi DiffAdd      ctermfg=NONE          ctermbg=Green
hi DiffChange   ctermfg=NONE          ctermbg=NONE
hi DiffDelete   ctermfg=LightBlue     ctermbg=Red
hi DiffText     ctermfg=Yellow        ctermbg=Red

function! Create_cscope_file(execfile)
	exe "! bash" a:execfile a:execfile                                                                  
endfunction
function! Create_cscope_out(cscope_files)
	exe "! cscope -bRq -i" a:cscope_files
endfunction
if has("cscope")
	let cscope_exec=findfile("cscope.sh", ".;")
	if !empty(cscope_exec)
		if cscope_exec ==? "cscope.sh"
			set csre
		endif
		silent call Create_cscope_file(cscope_exec)
		let cscope_files=findfile("cscope.files", ".;")
		if !empty(cscope_files) && filereadable(cscope_files)
			silent call Create_cscope_out(cscope_files)
			let cscope_out=findfile("cscope.out", ".;")
			if !empty(cscope_out) && filereadable(cscope_out)
				silent exe "cs add" cscope_out
			endif
		endif
	endif
endif

set cscopetag
set csto=0

if filereadable("cscope.out")
	cs add cscope.out   
elseif $CSCOPE_DB != ""
	cs add $CSCOPE_DB
endif
set cscopeverbose

nnoremap <F5> :exec 'NERDTreeToggle' <CR>

nmap zs :cs find s <C-R>=expand("<cword>")<CR><CR>
nmap zg :cs find g <C-R>=expand("<cword>")<CR><CR>
nmap zc :cs find c <C-R>=expand("<cword>")<CR><CR>
nmap zt :cs find t <C-R>=expand("<cword>")<CR><CR>
nmap ze :cs find e <C-R>=expand("<cword>")<CR><CR>
nmap zf :cs find f <C-R>=expand("<cfile>")<CR><CR>
nmap zi :cs find i ^<C-R>=expand("<cfile>")<CR>$<CR>
nmap zd :cs find d <C-R>=expand("<cword>")<CR><CR>

if has("autocmd")
    autocmd BufRead *.txt set tw=78
    autocmd BufReadPost *
    \ if line("'\"") > 0 && line ("'\"") <= line("$") |
    \   exe "normal g'\"" |
    \ endif
endif
